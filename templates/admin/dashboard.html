{% extends "base.html" %}
{% block title %}Administração{% endblock %}
{% block content %}
<h2>Painel do Administrador</h2>
<h4>Professores</h4>
<table class="table">
    <thead>
        <tr>
            <th>Matrícula</th><th>Nome</th><th>E-mail</th><th>Aprovado</th><th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for prof in professores %}
        <tr>
            <td>{{ prof.matricula }}</td>
            <td>{{ prof.nome }}</td>
            <td>{{ prof.email }}</td>
            <td>{{ 'Sim' if prof.aprovado else 'Não' }}</td>
            <td>
                {% if not prof.aprovado %}
                <form method="POST" action="{{ url_for('admin_aprovar_usuario', tipo='professor', matricula=prof.matricula) }}" style="display:inline;">
                    <button type="submit" class="btn btn-success btn-sm">Aprovar</button>
                </form>
                {% endif %}
                <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" data-action="{{ url_for('admin_excluir_usuario', tipo='professor', matricula=prof.matricula) }}" data-usuario="Professor {{ prof.nome }}" data-matricula="{{ prof.matricula }}">Excluir</button>
                <form method="POST" action="{{ url_for('admin_redefinir_senha', tipo='professor', matricula=prof.matricula) }}" style="display:inline;">
                    <input type="text" name="nova_senha" placeholder="Nova senha" required>
                    <button type="submit" class="btn btn-warning btn-sm">Redefinir Senha</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<h4>Alunos</h4>
<table class="table">
    <thead>
        <tr>
            <th>Matrícula</th><th>Nome</th><th>Email</th><th>Aprovado</th><th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for aluno in alunos %}
        <tr>
            <td>{{ aluno.matricula }}</td>
            <td>{{ aluno.nome }}</td>
            <td>{{ aluno.email }}</td>
            <td>{{ 'Sim' if aluno.aprovado else 'Não' }}</td>
            <td>
                {% if not aluno.aprovado %}
                <form method="POST" action="{{ url_for('admin_aprovar_usuario', tipo='aluno', matricula=aluno.matricula) }}" style="display:inline;">
                    <button type="submit" class="btn btn-success btn-sm">Aprovar</button>
                </form>
                {% endif %}
                <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" data-action="{{ url_for('admin_excluir_usuario', tipo='aluno', matricula=aluno.matricula) }}" data-usuario="Aluno {{ aluno.nome }}" data-matricula="{{ aluno.matricula }}">Excluir</button>
                <form method="POST" action="{{ url_for('admin_redefinir_senha', tipo='aluno', matricula=aluno.matricula) }}" style="display:inline;">
                    <input type="text" name="nova_senha" placeholder="Nova senha" required>
                    <button type="submit" class="btn btn-warning btn-sm">Redefinir Senha</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<!-- Modal de confirmação de exclusão -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar exclusão</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="POST" id="confirmDeleteForm">
        <div class="modal-body">
          Tem certeza que deseja excluir <span id="deleteUsuario"></span> (<span id="deleteMatricula"></span>)? Esta ação é irreversível.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-danger">Excluir</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  var confirmDeleteModal = document.getElementById('confirmDeleteModal');
  confirmDeleteModal.addEventListener('show.bs.modal', function (event) {
    var button = event.relatedTarget;
    var action = button.getAttribute('data-action');
    var usuario = button.getAttribute('data-usuario');
    var matricula = button.getAttribute('data-matricula');
    document.getElementById('confirmDeleteForm').setAttribute('action', action);
    document.getElementById('deleteUsuario').textContent = usuario;
    document.getElementById('deleteMatricula').textContent = matricula;
  });
});
</script>
{% endblock %}
